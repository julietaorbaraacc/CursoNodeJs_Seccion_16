<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Socket Chat</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
</head>

<body>
	<script src="https://accounts.google.com/gsi/client" async defer></script>

	<div class="container-xl">
		<div class="row">
			<div class="col">
				<h1>Socket Chat</h1>
				<hr>
				<div id="g_id_onload"
					data-client_id="181778491609-tov6kvavd476h4gittbq2dvvai0f0bdh.apps.googleusercontent.com"
					data-callback="handleCredentialResponse" data-auto_prompt="false">
				</div>
				<div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"
					data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left">
				</div>
				<button id="google_signout">Signout</button>
			</div>
		</div>
	</div>

	<script>
		function handleCredentialResponse(response) {
			//Creamos la constante body y le guardamos el valor del id_token que viene de la API
			const body = { id_token: response.credential }

			//Con fetch trabajamos a modo de promesa, le indicamos la url, el metodo los header y en el body le seteamos el valor que nos trajimos de la api
			fetch(window.location.hostname.includes('localhost') ? 'http://localhost:8080/api/auth/google' : 'https://cursonodejs-seccion-16.onrender.com/api/auth/google', {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify(body)
			})
				.then(resp => resp.json())
				.then(resp => {
					localStorage.setItem("email", resp.usuario.correo);
				})
				.catch(console.warn);
		}

		//Hacemos el logout de google
		const button = document.getElementById("google_signout");
		button.addEventListener("click", () => {
			google.accounts.id.disableAutoSelect();
			google.accounts.id.revoke(localStorage.getItem("email"), done => {
				localStorage.clear();
				location.reload();
			});
		});
	</script>
</body>

</html>